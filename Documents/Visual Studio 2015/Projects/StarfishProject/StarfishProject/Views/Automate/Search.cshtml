@using StarfishProject.Helpers;
@using System.Data;
@using PagedList.Mvc;
@using PagedList;

@{
    ViewBag.Title = "Search";
}

@{
    var dbs = (DatabaseSchema)ViewData["DatabaseSchema"];
}


@{
    var tbl = (Table)ViewData["TableData"];

}

@{
    var SearchElement = Session["SearchElement"] as List<SearchBox> ;
    int flag = 0;
}

@*@Model IPagedList<StarfishProject.Helpers.Table>*@
@model StaticPagedList<System.Data.DataRow>
    <head>

    </head>
    @{
        @Html.BeginForm("Search", "Automate", FormMethod.Post, new { enctype = "multipart/form-data" })
        {
            <h1>Table : @tbl.table_display_name</h1>
            <table id="table" class="table" border="1" style="align-content:center;border:groove">

                <tr class="breadcrumb">
                    @foreach (var obj in tbl.columns)
                    {
                        flag = 0;
                        <th>
                            @Html.ActionLink(obj.display_name, "SortColumn", "Automate", new { ColumnName = obj.column_name }, true)<br />

                            @if (SearchElement != null)
                            {
                                foreach (var col in SearchElement)
                                {
                                    if (col.column_name == obj.column_name)
                                    {
                                        <input type="text" name=@obj.column_name id=@obj.column_name value=@col.value />
                                        flag = 1;
                                        break;
                                    }

                                }
                            }
                            @if (flag == 0)
                            {
                                <input type="text" name=@obj.column_name id=@obj.column_name />
                            }

                        </th>
                    }
                    <th>
                         @Html.ActionLink("Reset", "GetTable", "Automate", new { TableName = tbl.table_name }, new { @class = "btn btn-primary", @style = "color:white" })
                        <input class="btn btn-primary" type="submit" value="search" id="search" />
                    </th>

                </tr>
                

                @foreach (DataRow dr in Model)
                {
                    <tr>
                        @for (int i = 1; i < dr.ItemArray.Count(); i++)
                        {
                            <td>@dr[i]</td>
                        }
                        <td>
                            @Html.ActionLink("Delete", "Delete", "Automate", new { TableName = tbl.table_name, id = dr[0] }, new { onclick = "return confirm('Are you sure you wish to delete this article?');" })
                        </td>
                    </tr>
                }

            </table>
                    }

    }

@Html.PagedListPager(Model, page => Url.Action("Search", "Automate", new { page, Table = ViewData["Table"] }), new PagedListRenderOptions() { Display = PagedListDisplayMode.IfNeeded, DisplayLinkToNextPage = PagedListDisplayMode.Always, DisplayPageCountAndCurrentLocation = true, LinkToNextPageFormat = "»", MaximumPageNumbersToDisplay = 10})
